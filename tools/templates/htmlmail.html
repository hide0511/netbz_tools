{% extends "base.html" %}
{% block title %}
テキストのHTML化
{% endblock %}
{% block content %}
<div class="col-sm-12 col-lg-9">
    <h2 class="mb-3">テキストのHTML化</h2>
</div>
<div class="col-sm-12 col-lg-6">

    <textarea id="baseText" style="width:100%" rows="15" placeholder="対象のテキストを入力してください" class="mb-2"></textarea>
    <textarea id="outputhtml" class="outputhtml" name="outputhtml" style="width:100%" rows="15" class="mb-2" readonly></textarea>
</div>

<div class="col-sm-12 col-lg-3">
    <p>HTML化する</p>
    <div class="m-1 border rounded">
        <button id="btnReplaceAll" class="m-2 btn w-75 btn-primary" type="button">一括置換</button>
    </div>

    <div id="messageArea"></div>
</div>

{% endblock %}

{% block script %}
<script type="text/javascript">
    var storeData = [];
    var storeIndex = 0;

     $('#btnReplaceAll').click(function() {

        var text  = document.getElementById('baseText').value.replace(/\r\n|\r/g, "\n");
        var lines = text.split( '\n' );
        var outArray = new Array();
        
        for ( var i = 0; i < lines.length; i++ ) {
            // 空行は無視する
            if ( lines[i] == '' ) {
                lines[i]  = '<p>&nbsp;</p>';
            } else {
                lines[i]  = '<p><span style="font-size: 12pt;">' + lines[i] + '</span></p>';
            }
        
            lines[i] = lines[i].replace('[link]', '')
            lines[i] = lines[i].replace('%%delpage%%', '<a href="%%Delpage%%">%%Delpage%%</a>')

            lines[i] = AutoLink(lines[i]) 

            outArray.push( lines[i] );
        }

        if( outArray.length ){
            var overridehtml = "";
            for ( var i = 0; i < outArray.length; i++ ) {
                overridehtml = overridehtml + outArray[i] + '\n';
            }
            $("textarea.outputhtml").val(overridehtml);
        }

        });

        function AutoLink(str) {
            var regexp_url = /((h?)(ttps?:\/\/[a-zA-Z0-9.\-_@:/~?%&;=+#',()*!]+))/g; // ']))/;
            var regexp_makeLink = function(all, url, h, href) {
                return '<a href="h' + href + '">' + url + '</a>';
            }
         
            return str.replace(regexp_url, regexp_makeLink);
        }

    function createRangeSelect(start, end) {
        let selection = document.getElementById('baseText');  
        selection.setSelectionRange(start, end);
        selection.focus();
    }

    function getCurrentLine(textarea) {
        return textarea.value.substr(0, textarea.selectionStart).split(/\r?\n/).length;
    }

    function scrollToLine(line) {
        var textarea = document.getElementById("baseText");
        var jump = (line - 1) * parseInt(getStyle(textarea, 'line-height'), 10);
        textarea.scrollTop = jump;
    }

    function getStyle(el, styleProp) {
        if (el.currentStyle) {
            var y = el.currentStyle[styleProp];
        } else if (window.getComputedStyle) {
            var y = document.defaultView.getComputedStyle(el, null).getPropertyValue(styleProp);
        }
        return y;
    }

    function saveData(data) {
        storeData.push(data);
        storeIndex = storeData.length - 1;
        //disableNextEnablePre();
        //$('#btnResetData').removeAttr("disabled");
        //$('#btnResetData').removeClass("blockCursor");
    }

    function disableNextEnablePre () {
        $('#btnNextData').attr("disabled", true);
        $('#btnNextData').addClass("blockCursor");
        $('#btnPreData').removeAttr("disabled");
        $('#btnPreData').removeClass("blockCursor");
    }
    
    function replaceAll(str, regExp, replace) {
        return str.replace(regExp, replace);
    }

    function escapeRegExp(str) {
        return str.replace(/([.*+?^=!:${}()|\[\]\/\\])/g, "\\$1");
    }
</script>
{% endblock %}


{% block url %}url: "{% url 'whois' %}",{% endblock %}